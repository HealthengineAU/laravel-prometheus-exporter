dist: focal

language: php

php:
  - 7.4
  - 8.0

env:
  - DEPENDENCY_VERSION=lowest LARAVEL_VERSION=7.* TESTBENCH_VERSION=^5.8
  - DEPENDENCY_VERSION=stable LARAVEL_VERSION=7.* TESTBENCH_VERSION=^5.8
  - DEPENDENCY_VERSION=lowest LARAVEL_VERSION=8.* TESTBENCH_VERSION=^6.23
  - DEPENDENCY_VERSION=stable LARAVEL_VERSION=8.* TESTBENCH_VERSION=^6.23

branches:
  only:
    - master

before_install:
  - echo "extension = apcu.so" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - echo "apc.enable_cli = 1" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - echo "extension = redis.so" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - composer require --no-interaction --no-update laravel/framework:${LARAVEL_VERSION} orchestra/testbench:${TESTBENCH_VERSION}
  - composer update --prefer-${DEPENDENCY_VERSION} --prefer-dist --no-interaction

script:
  - composer test
